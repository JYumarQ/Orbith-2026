{% extends 'base/base.html' %}

{% block title %}Unidad Organizativa{% endblock %}

{% block content %}

{% load static %}

  <!-- Content wrapper -->
  <div class="content-wrapper">
    <!-- Content -->

    <div class="container-xxl flex-grow-1 container-p-y">
      <h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light">Plantilla de Cargo /</span> Unidades Organizativas</h4>

      <!-- Hoverable Table rows -->
      <div class="card">
        <div class="card-header d-flex align-items-center">
        <!-- Barra de búsqueda (ocupa espacio sólo cuando no tiene d-none) -->
        <div id="search_container"
            class="nav-item d-flex align-items-center flex-grow-1 d-none">
          <i class="fas fa-search fa-lg me-2"></i>
          <input
            id="search"
            type="text"
            name="filter_unidad"
            class="form-control border-0 shadow-none"
            placeholder="Buscar..."
            aria-label="Buscar..."
            hx-get="{% url 'search_unidad_view' %}"
            hx-trigger="input changed delay:500ms, keyup[key=='Enter'], load"
            hx-target="#filter_unidad_results"
          />
        </div>

        <!-- Grupo de botones siempre a la derecha -->
        <div class="d-flex ms-auto">
          <button type="button" class="btn me-2" id="filter_button" onclick="show_hide_search()">
            <i class="fas fa-filter"></i>
          </button>
    
          <button type="button"
                  class="btn btn-primary"
                  onclick="abrir_modal_creacion('{% url 'add_uniorg' %}')">
            <i class="fas fa-plus"></i> Nueva Unidad
          </button>
        </div>
        
      </div>

        <div class="table-responsive text-nowrap">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Grupo de Nómina</th>
                <th>Descripción</th>
                <th class="text-center">Tipo</th>
                <th class="text-center">Acciones</th>
              </tr>
            </thead>
            <tbody class="table-border-bottom-0"  id="filter_unidad_results">
              {% include 'pages/uniorg/partials/filter_unidades_list.html' %}
            </tbody>
          </table>
        </div>
      </div>
      <!--/ Hoverable Table rows -->


      
    </div>
    <!-- / Content -->

    <div class="content-backdrop fade"></div>
  </div>
  <!-- Content wrapper -->


<!-- Incluir el modal del formulario -->
<div class="modal fade" id="editar_uniorg" role="dialog"></div>

<div class="modal fade" id="crear_uniorg" role="dialog"></div>


{% block extra_scripts %}
  <script type="text/javascript">
    var $ = jQuery.noConflict();
    function abrir_modal_edicion(url){
      $('#editar_uniorg').load(url, function(){
        $(this).modal('show');
      })
    }
    function abrir_modal_creacion(url){
      $('#crear_uniorg').load(url, function(){
        $(this).modal('show');
      })
    }

    function show_hide_search(){
      $('#search_container').toggleClass('d-none');
      if ($('#search_container').hasClass('d-none')) {
        $('#search').val('');
        // Cargar la lista completa cuando se oculta la barra de búsqueda
        htmx.ajax('GET', "{% url 'search_unidad_view' %}", {target:'#filter_unidad_results'});
      } else {
        // opcional: poner foco en el input al abrir
        $('#search').focus();
      }
    }

    // Agregar evento para la tecla Escape
    $(document).ready(function() {
      $('#search').on('keydown', function(e) {
        if (e.key === 'Escape') {
          // Limpiar el campo de búsqueda
          $(this).val('');
          // Cargar la lista completa
          htmx.ajax('GET', "{% url 'search_unidad_view' %}", {target:'#filter_unidad_results'});
        }
      });
    });


  </script>
{% endblock extra_scripts %}

{% endblock %}


