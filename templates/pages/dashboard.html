{% extends 'base/base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
{% load static %}
<!-- Content wrapper -->
<div class="content-wrapper">
  <div class="container-xxl flex-grow-1 container-p-y">
    <div class="row g-3">
      {% comment %}<!-- Card Bienvenida Sneat (creativo, disruptivo, SVG decorativo) -->
      <div class="col-12 mb-3">
        <div class="card h-100 position-relative overflow-hidden" style="background: linear-gradient(90deg, #f8fafc 60%, #f3f4f6 100%); min-height: 150px;">
          <svg width="120" height="120" viewBox="0 0 120 120" fill="none" class="position-absolute end-0 top-0 opacity-25" style="z-index:0;">
            <circle cx="60" cy="60" r="60" fill="#6366f1"/>
            <circle cx="100" cy="20" r="20" fill="#a5b4fc"/>
          </svg>
          <div class="card-body d-flex align-items-center p-3 position-relative" style="z-index:1;">
            <div class="flex-grow-1">
              <h4 class="mb-1 fw-bold text-primary">¬°Bienvenido a <span class="text-gradient">RRHH Orbith</span>! üöÄ</h4>
              <p class="mb-2">Gestiona el talento, <span class="fw-bold text-success">innova</span> y potencia el bienestar.<br><span class="badge bg-label-info fs-6 animate__animated animate__pulse animate__infinite">NUEVO</span></p>
              <a href="#" class="btn btn-gradient-primary btn-sm mt-1">Ver Perfil</a>
            </div>
            <img src="{% static 'img/illustrations/man-with-laptop-light.png' %}" height="100" alt="RRHH" class="ms-3 d-none d-md-block" style="filter: drop-shadow(0 4px 12px #6366f133);" />
          </div>
        </div>
      </div> {% endcomment %}
      <!-- M√©tricas clave RRHH (cards creativos, iconos grandes, gradientes, badges) -->
      <div class="col-12">
        <div class="row g-3">
          <div class="col-6 col-md-3 col-lg-2">
            <div class="card text-center p-3 shadow-sm border-0 animate__animated animate__fadeInUp">
              <div class="icon-circle bg-gradient-primary mb-2 mx-auto"><i class="bx bx-group fs-2 text-white"></i></div>
              <div class="fw-bold fs-3">{{ contratos.count }}</div>
              <span class="badge bg-label-success mb-1">Total</span>
              <small class="text-muted">Empleados</small>
            </div>
          </div>
          <div class="col-6 col-md-3 col-lg-2">
            <div class="card text-center p-3 shadow-sm border-0 animate__animated animate__fadeInUp animate__delay-1s">
              <div class="icon-circle bg-gradient-info mb-2 mx-auto"><i class="bx bx-file fs-2 text-white"></i></div>
              <div class="fw-bold fs-3">132</div>
              <span class="badge bg-label-primary mb-1">Nuevo</span>
              <small class="text-muted">Contratos</small>
            </div>
          </div>
          <div class="col-6 col-md-3 col-lg-2">
            <div class="card text-center p-3 shadow-sm border-0 animate__animated animate__fadeInUp animate__delay-2s">
              <div class="icon-circle bg-gradient-success mb-2 mx-auto"><i class="bx bx-dollar-circle fs-2 text-white"></i></div>
              <div class="fw-bold fs-3">$1,250</div>
              <span class="badge bg-label-warning mb-1">‚Üë</span>
              <small class="text-muted">Salario Prom.</small>
            </div>
          </div>
          <div class="col-6 col-md-3 col-lg-2">
            <div class="card text-center p-3 shadow-sm border-0 animate__animated animate__fadeInUp animate__delay-3s">
              <div class="icon-circle bg-gradient-danger mb-2 mx-auto"><i class="bx bx-user-voice fs-2 text-white"></i></div>
              <div class="fw-bold fs-3">{{ plazas.vacantes }}</div>
              <span class="badge bg-label-danger mb-1">Alerta</span>
              <small class="text-muted">Vacantes</small>
            </div>
          </div>
          <div class="col-6 col-md-3 col-lg-2">
            <div class="card text-center p-3 shadow-sm border-0 animate__animated animate__fadeInUp animate__delay-4s">
              <div class="icon-circle bg-gradient-info mb-2 mx-auto"><i class="bx bx-run fs-2 text-white"></i></div>
              <div class="fw-bold fs-3">2.1%</div>
              <span class="badge bg-label-warning mb-1">Bajo</span>
              <small class="text-muted">Ausentismo</small>
            </div>
          </div>
          <div class="col-6 col-md-3 col-lg-2">
            <div class="card text-center p-3 shadow-sm border-0 animate__animated animate__fadeInUp animate__delay-5s">
              <div class="icon-circle bg-gradient-secondary mb-2 mx-auto"><i class="bx bx-building-house fs-2 text-white"></i></div>
              <div class="fw-bold fs-3">{{ dptos.count }}</div>
              <span class="badge bg-label-info mb-1">Deptos</span>
              <small class="text-muted">Departamentos</small>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Gr√°ficos creativos y disruptivos -->
      <!-- G√©nero: barra de progreso animada con avatares -->
      <div class="col-12 col-md-4 mt-3">
        <div class="card h-100 shadow border-0 animate__animated animate__fadeInLeft">
          <div class="card-body d-flex flex-column justify-content-center align-items-center">
            <h6 class="mb-3">Equilibrio de G√©nero</h6>
            <div class="w-100 position-relative" style="height: 60px; margin-bottom: 18px;">
              <div class="d-flex align-items-center justify-content-between w-100" style="height: 60px;">
                <span class="d-flex align-items-center justify-content-center" style="width: 44px; height: 60px;">
                  <i class="bx bx-male fs-1 text-info" title="Masculino"></i>
                </span>
                <div class="flex-grow-1 position-relative" style="height: 60px;">
                  <div class="d-flex w-100" 
                      style="height: 60px; background: #f3f4f6; border-radius: 30px; overflow: hidden;">
                    <!-- Parte hombres -->
                    <div class="d-flex align-items-center justify-content-center bg-gradient-info"
                        style="width: {{ generos.porc_hombres }}%; font-size:0.8em;">
                      <span class="text-white fw-bold">{{ generos.porc_hombres }}%</span>
                    </div>
                    <!-- Parte mujeres -->
                    <div class="d-flex align-items-center justify-content-center bg-gradient-danger"
                        style="width: {{ generos.porc_mujeres }}%; font-size:0.8em;">
                      <span class="text-white fw-bold">{{ generos.porc_mujeres }}%</span>
                    </div>
                  </div>
                </div>
                <span class="d-flex align-items-center justify-content-center" style="width: 44px; height: 60px;">
                  <i class="bx bx-female fs-1 text-danger" title="Femenino"></i>
                </span>
              </div>
              <span class="badge bg-label-info position-absolute start-0 top-100 mt-2" style="font-size: 0.95em;">Masculino</span>
              <span class="badge bg-label-danger position-absolute end-0 top-100 mt-2" style="font-size: 0.95em;">Femenino</span>
            </div>
            <div class="text-center mt-4">
              <small class="text-muted">Tendencia: <span class="fw-bold text-success">+2% mujeres este mes(calcular)</span></small>
            </div>
          </div>
        </div>
      </div>
      <!-- Ocupaci√≥n: gauge con icono -->
      <div class="col-12 col-md-4 mt-3">
        <div class="card h-100 shadow border-0 animate__animated animate__fadeInUp">
          <div class="card-body text-center">
            <h6 class="mb-2">Ocupaci√≥n de Plazas</h6>
            <div id="plazasGaugeChart" style="height: 120px;"></div>
            <div class="d-flex align-items-center justify-content-center mt-2 gap-2">
              <i class="bx bx-user-check fs-3 text-success"></i>
              <span class="fw-bold text-success" style="font-size:1.3em;">{{ plazas.porc_cubiertas }}</span>
              <span class="text-muted">ocupadas</span>
            </div>
            <div class="d-flex justify-content-center gap-2 mt-1">
              <span class="badge bg-label-success">{{ plazas.cubiertas }} ocupadas</span>
              <span class="badge bg-label-secondary">{{ plazas.vacantes }} vacantes</span>
            </div>
          </div>
        </div>
      </div>
      <!-- Altas/Bajas: √°rea apilada y mini-m√©tricas -->
      <div class="col-12 col-md-4 mt-3">
        <div class="card h-100 shadow border-0 animate__animated animate__fadeInRight">
          <div class="card-body">
            <h6 class="mb-2">Altas y Bajas por Mes</h6>
            <div id="altasBajasAreaChart" style="height: 110px;"></div>
            <div class="row text-center mt-2">
              <div class="col-6">
                <span class="fw-bold text-primary" style="font-size:1.2em;">+12</span>
                <span class="badge bg-label-primary ms-1">Altas</span>
              </div>
              <div class="col-6">
                <span class="fw-bold text-danger" style="font-size:1.2em;">-3</span>
                <span class="badge bg-label-danger ms-1">Bajas</span>
              </div>
            </div>
            <div class="text-center mt-1">
              <small class="text-muted">Tendencia mensual</small>
            </div>
          </div>
        </div>
      </div>
      <!-- Cards inferiores alineados: Cumplea√±os, Avisos, Resumen -->
      <div class="dashboard-bottom-row mt-3" style="display: flex; gap: 18px;">
        <div class="card mb-0 shadow border-0 animate__animated animate__fadeInLeft" style="flex:1; min-width:0; height: 370px;">
          <div class="card-header bg-label-primary d-flex align-items-center">
            <i class="bx bx-cake fs-3 text-primary me-2"></i>
            <span class="fw-bold">Pr√≥ximos Cumplea√±os</span>
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item d-flex align-items-center">
              <img src="https://randomuser.me/api/portraits/men/32.jpg" class="rounded-circle me-2 border border-2 border-primary" width="40" height="40" alt="">
              <span class="fw-semibold">Carlos P√©rez</span>
              <span class="badge bg-label-info ms-auto animate__animated animate__pulse animate__infinite">21 Jul</span>
            </li>
            <li class="list-group-item d-flex align-items-center">
              <img src="https://randomuser.me/api/portraits/women/44.jpg" class="rounded-circle me-2 border border-2 border-info" width="40" height="40" alt="">
              <span class="fw-semibold">Mar√≠a L√≥pez</span>
              <span class="badge bg-label-info ms-auto animate__animated animate__pulse animate__infinite">23 Jul</span>
            </li>
            <li class="list-group-item d-flex align-items-center">
              <img src="https://randomuser.me/api/portraits/men/45.jpg" class="rounded-circle me-2 border border-2 border-primary" width="40" height="40" alt="">
              <span class="fw-semibold">Luis Torres</span>
              <span class="badge bg-label-info ms-auto animate__animated animate__pulse animate__infinite">25 Jul</span>
            </li>
            <li class="list-group-item d-flex align-items-center">
              <img src="https://randomuser.me/api/portraits/women/55.jpg" class="rounded-circle me-2 border border-2 border-info" width="40" height="40" alt="">
              <span class="fw-semibold">Ana Garc√≠a</span>
              <span class="badge bg-label-info ms-auto animate__animated animate__pulse animate__infinite">28 Jul</span>
            </li>
            <li class="list-group-item d-flex align-items-center">
              <img src="https://randomuser.me/api/portraits/men/60.jpg" class="rounded-circle me-2 border border-2 border-primary" width="40" height="40" alt="">
              <span class="fw-semibold">Jorge D√≠az</span>
              <span class="badge bg-label-info ms-auto animate__animated animate__pulse animate__infinite">30 Jul</span>
            </li>
          </ul>
        </div>


        <div class="card mb-0 shadow border-0 animate__animated animate__fadeInUp" style="flex:1; min-width:0; height: 370px;">
          <div class="card-header bg-label-danger d-flex align-items-center">
            <i class="bx bx-error-circle fs-3 text-danger me-2"></i>
            <span class="fw-bold">Avisos de Contratos</span>
          </div>
          <ul class="list-group list-group-flush">


            {% for c in contratos|slice:":5" %}
              {% if c.tipo != 'IND' %}
                <li class="list-group-item d-flex align-items-center">
                  <i class="bx bx-alarm-exclamation text-danger fs-4 me-2"></i>
                  <span>Vence: <b>{{ c.aspirante.nombre }} {{ c.aspirante.papellido }} {{ c.aspirante.sapellido }}</b></span>
                  {% if c.fecha_vencimiento == 0 %}
                    <span class="badge bg-danger ms-auto animate__animated animate__flash animate__infinite">¬°Hoy!</span>
                  {% else %}
                    <span class="badge bg-warning text-dark ms-auto animate__animated animate__flash animate__infinite">{{ c.dias_restantes }} d√≠as</span>
                  {% endif %}
                </li>
              {% endif %}
              
            {% endfor %}

            
          </ul>
        </div>
        <div class="card mb-0 shadow border-0 animate__animated animate__fadeInRight" style="flex:1; min-width:0; height: 370px;">
          <div class="card-header d-flex align-items-center justify-content-between pb-0">
            <h6 class="m-0">Resumen de Personal</h6>
            <span class="badge bg-label-info">Julio 2025</span>
          </div>
          <div class="card-body d-flex flex-column justify-content-center align-items-center">
            <div id="personalPieChart" style="width: 160px; height: 160px; margin-top: 10px;"></div>
            <div class="d-flex justify-content-center align-items-end gap-4 mt-4 mb-2 w-100">
              <div class="text-center flex-fill">
                <div class="icon-circle bg-gradient-warning mb-1 mx-auto"><i class="bx bx-book-content fs-3 text-white"></i></div>
                <div class="fw-bold fs-5 text-warning">18</div>
                <small class="text-muted">Capacitaciones</small>
              </div>
              <div class="text-center flex-fill">
                <div class="icon-circle bg-gradient-primary mb-1 mx-auto"><i class="bx bx-timer fs-3 text-white"></i></div>
                <div class="fw-bold fs-6 text-primary">5.2 a√±os</div>
                <small class="text-muted">Antig√ºedad Prom.</small>
              </div>
              <div class="text-center flex-fill">
                <div class="icon-circle bg-gradient-danger mb-1 mx-auto"><i class="bx bx-refresh fs-3 text-white"></i></div>
                <div class="fw-bold fs-6 text-danger">7.8%</div>
                <small class="text-muted">Rotaci√≥n</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="content-backdrop fade"></div>
</div>
<!-- Content wrapper -->
<style>
.dashboard-bottom-row { display: flex; gap: 24px; }
.dashboard-bottom-row > .card { flex: 1 1 0; min-width: 0; height: 370px; margin-bottom: 0; }
@media (max-width: 991px) {
  .dashboard-bottom-row { flex-direction: column; gap: 0; }
  .dashboard-bottom-row > .card { margin-bottom: 24px; }
}
</style>
<!-- Scripts para gr√°ficos (ApexCharts) -->
<!-- Carga local de iconos Boxicons y FontAwesome -->

<script>
// Ejemplo de inicializaci√≥n de gr√°ficos personalizados para RRHH
// √Årea empleados (m√°s peque√±o y con datos visibles)
var empleadosAreaChart = new ApexCharts(document.querySelector('#empleadosAreaChart'), {
  series: [{ name: 'Empleados', data: [150, 152, 155, 158, 162, 170, 184] }],
  chart: { type: 'area', height: 70, sparkline: { enabled: true } },
  colors: ['#696cff'],
  fill: { type: 'gradient', gradient: { shadeIntensity: 0.5, opacityFrom: 0.7, opacityTo: 0.2, stops: [0, 100] } },
  stroke: { curve: 'smooth', width: 2 },
  xaxis: { categories: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul'], labels: { show: true, style: { fontSize: '10px' } } },
  yaxis: { show: false, min: 140, max: 200 },
  dataLabels: { enabled: false },
  tooltip: { enabled: true }
});
empleadosAreaChart.render();
// Barra de g√©nero animada
setTimeout(function() {
  document.getElementById('generoProgressBar').style.width = '53%';
}, 200);

// Gauge ocupaci√≥n
var plazasGaugeChart = new ApexCharts(document.querySelector('#plazasGaugeChart'), {
  series: ['{{ plazas.porc_cubiertas }}'],
  chart: { type: 'radialBar', height: 120, sparkline: { enabled: true } },
  colors: ['#22c55e'],
  plotOptions: {
    radialBar: {
      hollow: { size: '70%' },
      track: { background: '#f3f4f6' },
      dataLabels: {
        show: true,
        value: { fontSize: '22px', color: '#22c55e', fontWeight: 700, offsetY: 8 },
        name: { show: false }
      }
    }
  },
  labels: ['Ocupaci√≥n']
});
plazasGaugeChart.render();

// √Årea apilada altas/bajas
var altasBajasAreaChart = new ApexCharts(document.querySelector('#altasBajasAreaChart'), {
  series: [
    { name: 'Altas', data: [2, 3, 1, 4, 2, 0, 3] },
    { name: 'Bajas', data: [1, 0, 2, 1, 0, 1, 1] }
  ],
  chart: { type: 'area', height: 110, stacked: true, sparkline: { enabled: true } },
  colors: ['#6366f1', '#ef4444'],
  fill: { type: 'gradient', gradient: { shadeIntensity: 0.7, opacityFrom: 0.7, opacityTo: 0.2, stops: [0, 100] } },
  stroke: { curve: 'smooth', width: 2 },
  xaxis: { categories: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul'], labels: { show: false } },
  yaxis: { show: false },
  dataLabels: { enabled: false },
  legend: { show: false },
  tooltip: { enabled: true }
});
altasBajasAreaChart.render();

// Pie chart para resumen de personal (Capacitaciones, Antig√ºedad, Rotaci√≥n)
var personalPieChart = new ApexCharts(document.querySelector('#personalPieChart'), {
  series: [18, 5.2, 7.8],
  chart: { type: 'pie', height: 160 },
  labels: ['Capacitaciones', 'Antig√ºedad', 'Rotaci√≥n'],
  colors: ['#fbbf24', '#6366f1', '#ef4444'],
  legend: { show: false },
  dataLabels: {
    enabled: false
  },
  tooltip: { enabled: true },
  plotOptions: {
    pie: {
      dataLabels: { enabled: false },
      donut: { size: '0%' }
    }
  }
});
personalPieChart.render();
</script>
<!-- Estilos creativos y animaciones -->
<style>
.icon-circle {
  width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
  box-shadow: 0 2px 8px #6366f122; font-size: 2rem;
}
.bg-gradient-primary { background: linear-gradient(135deg, #6366f1 60%, #818cf8 100%) !important; }
.bg-gradient-info { background: linear-gradient(135deg, #06b6d4 60%, #38bdf8 100%) !important; }
.bg-gradient-success { background: linear-gradient(135deg, #22c55e 60%, #4ade80 100%) !important; }
.bg-gradient-danger { background: linear-gradient(135deg, #ef4444 60%, #f87171 100%) !important; }
.bg-gradient-warning { background: linear-gradient(135deg, #fde68a 60%, #fef9c3 100%) !important; }
.bg-gradient-secondary { background: linear-gradient(135deg, #64748b 60%, #a5b4fc 100%) !important; }
.legend-dot { width: 14px; height: 14px; border-radius: 50%; display: inline-block; }
.bg-info { background: #06b6d4 !important; }
.bg-danger { background: #ef4444 !important; }
.bg-label-info { background: #e0f2fe !important; color: #0369a1 !important; }
.bg-label-success { background: #dcfce7 !important; color: #166534 !important; }
.bg-label-primary { background: #e0e7ff !important; color: #3730a3 !important; }
.bg-label-warning { background: #fef9c3 !important; color: #b45309 !important; }
.bg-label-secondary { background: #f3f4f6 !important; color: #64748b !important; }
.animate__animated { animation-duration: 1s; animation-fill-mode: both; }
.animate__infinite { animation-iteration-count: infinite; }
.animate__pulse { animation-name: pulse; }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.08); } 100% { transform: scale(1); } }
.animate__flash { animation-name: flash; }
@keyframes flash { 0%,100%{opacity:1;} 50%{opacity:.4;} }
.animate__fadeInUp { animation-name: fadeInUp; }
@keyframes fadeInUp { from { opacity: 0; transform: translate3d(0, 40px, 0); } to { opacity: 1; transform: none; } }
.animate__fadeInLeft { animation-name: fadeInLeft; }
@keyframes fadeInLeft { from { opacity: 0; transform: translate3d(-40px, 0, 0); } to { opacity: 1; transform: none; } }
.animate__fadeInRight { animation-name: fadeInRight; }
@keyframes fadeInRight { from { opacity: 0; transform: translate3d(40px, 0, 0); } to { opacity: 1; transform: none; } }
.btn-gradient-primary { background: linear-gradient(90deg, #6366f1 60%, #818cf8 100%); color: #fff; border: none; }
.btn-gradient-primary:hover { background: linear-gradient(90deg, #818cf8 60%, #6366f1 100%); color: #fff; }
.text-gradient { background: linear-gradient(90deg, #6366f1 60%, #3730a3 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
</style>
{% endblock %}