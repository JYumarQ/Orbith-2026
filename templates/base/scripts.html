{% load static %}

<!--SCRIPTS-->
<!-- Helpers -->

<script src="{% static 'vendor/js/htmx.min.js' %}"></script>

<script src="{% static 'vendor/libs/jquery/jquery-3.7.1.min.js' %}"></script>

<script src="{% static 'vendor/js/helpers.js' %}"></script>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'vendor/libs/perfect-scrollbar/perfect-scrollbar.js' %}"></script>
<!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
<script src="{% static 'js/config.js' %}"></script>
<script src="{% static 'vendor/js/select2.min.js' %}"></script>


<script src="{% static 'vendor/js/menu.js' %}"></script>
<!-- endbuild -->

<!-- Vendors JS -->
<script src="{% static 'js/apexcharts.min.js' %}"></script>

<!-- Main JS -->
<script src="{% static 'js/main.js' %}"></script>

<!-- Page JS -->
<script src="{% static 'js/dashboards-analytics.js' %}"></script>

<!-- Place this tag in your head or just before your close body tag. -->
<script src="{% static 'vendor/js/buttons.js' %}"></script>


<script src="{% static 'js/sweetalert2.js' %}"></script>



<script>
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
  }
  const csrftoken = getCookie('csrftoken');

  htmx.on('htmx:configRequest', (event) => {
    // Solo añade el token a peticiones que lo necesitan (no GET)
    if (['POST', 'PUT', 'DELETE'].includes(event.detail.verb)) {
      event.detail.headers['X-CSRFToken'] = csrftoken;
    }
  });
</script>

<script>
  document.body.addEventListener('click', function (e) {
    const btn = e.target.closest('[data-swal-confirm][hx-post], [data-swal-confirm][hx-delete]');
    if (!btn) return;

    e.preventDefault();
    e.stopPropagation();
    if(typeof e.stopImmediatePropagation === 'function') e.stopImmediatePropagation();
      
    
    const msg   = btn.getAttribute('data-swal-confirm') || '¿Deseas continuar?';
    
    
    Swal.fire({
      title: '¿Estás seguro?',
      text: msg,
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: /elimin/i.test(msg) ? 'Sí, ¡eliminar!' : 'Continuar',
      cancelButtonText: 'Cancelar'
    }).then((res) => {
      if (res.isConfirmed) {
        htmx.trigger(btn, 'confirmed');
      }
    });
  }, true);

</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // 1. Definimos el diseño de la notificación pequeña
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
            }
        });

        // 2. Iteramos los mensajes que envía Django desde las vistas
        {% if messages %}
            {% for message in messages %}
                
                // Convertimos tags de Django a iconos de SweetAlert
                var type = "{{ message.tags }}";
                if(type === 'danger') type = 'error';
                if(type === 'debug') type = 'info';

                Toast.fire({
                    icon: type, 
                    title: "{{ message }}"
                });

            {% endfor %}
        {% endif %}
    });
</script>



{% block extra_scripts %}{% endblock %}